// ‚ö†Ô∏è DO NOT EDIT THIS FILE MANUALLY ‚ö†Ô∏è
// This file is auto-generated by scripts/build_tasks.json.py
// Any manual changes will be overwritten when the build script runs.
// To modify tasks, edit the modular files in .vscode/tasks/ instead.
// See .vscode/README.md üìñ for more information.
{
    "version": "2.0.0",
    "inputs": [
        {
            "id": "github_workflow_name",
            "type": "promptString",
            "description": "Name of the GitHub workflow to run",
            "default": ""
        },
        {
            "id": "migration_description",
            "type": "promptString",
            "description": "Description of the migration",
            "default": ""
        },
        {
            "id": "playwright_run_tests_headed_toggle",
            "type": "pickString",
            "description": "Select whether we should run the Playwright tests in headed mode. Headless mode is faster, but this way you can watch the tests run in the browser.",
            "options": [
                "",
                "--headed"
            ]
        },
        {
            "id": "playwright_recorder_url",
            "type": "promptString",
            "description": "URL to record a new Playwright test for",
            "default": "http://localhost:3000"
        },
        {
            "id": "playwright_run_tests_ui_display_toggle",
            "type": "pickString",
            "description": "Select whether we should show the Playwright UI (allows for debugging of tests when running tests)",
            "options": [
                "",
                "--ui"
            ]
        },
        {
            "id": "playwright_recorder_test_output_file_path",
            "type": "promptString",
            "description": "Path for the generated Playwright test file to be saved to (relative to the `frontend/e2e_tests` directory)",
            "default": "new_test.spec.ts"
        },
        {
            "id": "remove_cache_extent",
            "type": "pickString",
            "description": "Extent of the cache cleanup (soft = just the cache files, hard = cache files + dependencies)",
            "options": [
                {
                    "label": "Soft",
                    "value": "--soft"
                },
                {
                    "label": "Hard",
                    "value": "--hard"
                },
                {
                    "label": "Dry run",
                    "value": "--dry-run"
                }
            ]
        },
        {
            "id": "select_PR_merge_into_branch",
            "type": "pickString",
            "description": "Select the branch to merge the PR into",
            "options": [
                "sandbox",
                "dev",
                "main"
            ]
        },
        {
            "id": "storybook_environment",
            "type": "pickString",
            "description": "Select Storybook environment (We can't open the browser from the DevContainer)",
            "options": [
                {
                    "label": "Container (no auto-open)",
                    "value": "container"
                },
                {
                    "label": "Host (auto-open browser)",
                    "value": "host"
                }
            ],
            "default": "container"
        }
    ],
    "tasks": [
        {
            "label": "API: Generate TypeScript SDK for Frontend",
            "detail": "Creates OpenAPI schema and Frontend SDK",
            "type": "shell",
            "command": "bash",
            "options": {
                "cwd": "${workspaceFolder}/scripts"
            },
            "args": [
                "-lc",
                "./generate_api_client.sh"
            ]
        },
        {
            "label": "Backend: Install dependencies",
            "detail": "Sync dependencies using uv (creates .venv + updates it based on pyproject.toml)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "uv sync"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Backend: Update UV lockfile and sync dependencies",
            "detail": "You may want to make changes to the prescribed dependency ranges in the pyproject.toml file before running this task",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "uv lock --upgrade && uv sync"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Chrome: Open with DevTools",
            "detail": "Open Chrome with DevTools auto-opened, using a persistent profile, accepting remote debugging connections on port 9222, and tabs for Next.js and FastAPI docs",
            "type": "shell",
            "command": "${workspaceFolder}/backend/.venv/bin/python3",
            "args": [
                "${workspaceFolder}/scripts/launch_chrome_browser.py"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
            "problemMatcher": []
        },
        {
            "label": "DB: Create migration",
            "detail": "Create a new migration file based on the delta between the current database schema and the backend models",
            "type": "shell",
            "command": "bash",
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python -m alembic revision -m \"${input:migration_description}\" --autogenerate"
            ]
        },
        {
            "label": "DB: Migrate",
            "detail": "Run alembic migrations (sync DB and backend models)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "'${workspaceFolder}/backend/.venv/bin/python' -m alembic upgrade head"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "DB: Seed (.env.local DB)",
            "detail": "Seed the database with initial users + Customer (this can only run once, as controlled by the Config Table's DB_WAS_SEEDED flag)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "'${workspaceFolder}/backend/.venv/bin/python' -m app.utils.db.seed_data"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "DB: Drop schema (Docker DB)",
            "detail": "Drop the schema in Docker DB (removes all tables)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "docker exec -i postgres_development_container psql -U postgres_user -d postgres -v ON_ERROR_STOP=1 -c \"DROP SCHEMA IF EXISTS public CASCADE; CREATE SCHEMA public; GRANT ALL ON SCHEMA public TO postgres_user; GRANT ALL ON SCHEMA public TO public;\""
            ],
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Dev Tasks: Clean cache files",
            "detail": "Clean cache files (node_modules, .venv, etc.)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python scripts/remove_project_cache_files.py ${input:remove_cache_extent}"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Dev Tasks: Generate VSCode tasks.json",
            "detail": "Regenerate .vscode/tasks.json from modular task files in tasks/ (NOTE: The watchdog can be doing this automatically for you)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python scripts/generate_vscode_tasks.json.py"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Dev Tasks: Run file watchers (WatchDog)",
            "detail": "Watchers listening for file changes and perform actions based on the changes (e.g. rebuilding tasks.json, generating TypeScript SDK, etc.)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python scripts/file_watchers/_runner.py"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "File Watchers"
            }
        },
        {
            "label": "Dev Tasks: Generate VS Code Tasks markdown table",
            "detail": "Generate a markdown table from .vscode/tasks.json showing all task labels and details",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python scripts/generate_vscode_tasks_table.py"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Docker: Provide DB",
            "detail": "Start the Postgres container",
            "type": "process",
            "command": "docker",
            "args": [
                "compose",
                "-f",
                "${workspaceFolder}/docker-compose.yml",
                "up",
                "-d",
                "db"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "silent",
                "panel": "dedicated"
            }
        },
        {
            "label": "Docker: Provide OTEL LGTM",
            "detail": "Start the OTEL LGTM container",
            "type": "process",
            "command": "docker",
            "args": [
                "compose",
                "-f",
                "${workspaceFolder}/docker-compose.yml",
                "up",
                "-d",
                "lgtm"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "silent",
                "panel": "dedicated"
            }
        },
        {
            "label": "Docker: Wait for Postgres health",
            "detail": "We need the Postgres container to be healthy before we can run alembic migrations + seed the data",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "command": "bash",
            "args": [
                "-lc",
                "until [ \"$(docker inspect -f \"{{.State.Health.Status}}\" postgres_development_container)\" = \"healthy\" ]; do echo \"Waiting for Postgres healthcheck...\"; sleep 2; done"
            ],
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Frontend: Install dependencies",
            "detail": "Install dependencies using pnpm",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm install"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Frontend: Run Storybook",
            "detail": "Run Storybook (selects script based on environment)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm run storybook:${input:storybook_environment}"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Storybook"
            }
        },
        {
            "label": "Frontend: Vitest: Run Unit Tests (watch mode, with browser)",
            "detail": "Browser not available in the DevContainer",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm run unit-test"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Vitest"
            }
        },
        {
            "label": "Frontend: Vitest: Run Unit Tests (watch mode, headless)",
            "detail": "",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm run unit-test:headless"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Vitest"
            }
        },
        {
            "label": "Frontend: Vitest: Run Unit Tests Coverage",
            "detail": "Generates coverage report HTML in ./frontend/coverage",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm run unit-test:coverage"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Vitest: Coverage"
            }
        },
        {
            "label": "Frontend: Vitest: Update screenshots",
            "detail": "Update screenshots for visual regression testing",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm run unit-test:update-screenshots"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Vitest"
            }
        },
        {
            "label": "Frontend: Playwright: Run e2e Tests",
            "detail": "Optionally shows the UI for debugging",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm exec playwright test ${input:playwright_run_tests_ui_display_toggle} ${input:playwright_run_tests_headed_toggle}"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Playwright"
            }
        },
        {
            "label": "Frontend: Playwright: Show Last Report",
            "detail": "Show Last Report (in browser)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "pnpm exec playwright show-report"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Playwright"
            }
        },
        {
            "label": "Frontend: Playwright: Record new Test",
            "detail": "Record new Test (using the Playwright Test Recorder)",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "npx playwright codegen ${input:playwright_recorder_url} -o ./e2e_tests/${input:playwright_recorder_test_output_file_path}"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend/"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "group": "Playwright"
            }
        },
        {
            "label": "Git: Create PR",
            "detail": "Create a PR for the current branch, brings up the PR in the browser",
            "type": "shell",
            "command": "gh",
            "args": [
                "pr",
                "create",
                "--base",
                "${input:select_PR_merge_into_branch}",
                "--web"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "GitHub Actions: List Workflows",
            "detail": "List all the workflows in the repository",
            "type": "shell",
            "command": "act",
            "args": [
                "-l"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "GitHub Actions: Run a specific Workflow",
            "detail": "You will be prompted for the workflow name",
            "type": "shell",
            "command": "act",
            "args": [
                "-j",
                "${input:github_workflow_name}",
                "--secret-file",
                "${workspaceFolder}/.github/workflows/actions_local_testing_secrets"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "GitHub Actions: Run All Workflows",
            "detail": "Run all the workflows in the repository",
            "type": "shell",
            "command": "act",
            "args": [
                "--secret-file",
                "${workspaceFolder}/.github/workflows/actions_local_testing_secrets"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint Backend: Ty",
            "detail": "Check the Backend for type errors using Ty",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "uv run ty check"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint Frontend: tsc",
            "detail": "Apply the TypeScript type checker",
            "type": "shell",
            "command": "${workspaceFolder}/frontend/node_modules/.bin/tsc",
            "args": [
                "--noEmit"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint Frontend: Biome",
            "detail": "Biome linter will apply safe fixes",
            "type": "shell",
            "command": "pnpm",
            "args": [
                "lint:fix"
            ],
            "options": {
                "cwd": "${workspaceFolder}/frontend"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint Backend: Ruff",
            "detail": "Ruff linter will apply safe fixes",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "uv run ruff check --fix"
            ],
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint: Run Pre-commit Hooks",
            "detail": "Run the pre-commit hooks for the project",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/pre-commit run --all-files"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Lint: Project",
            "detail": "Runs all the Linters",
            "dependsOn": [
                "Lint Frontend: tsc",
                "Lint Frontend: Biome",
                "Lint Backend: Ty",
                "Lint Backend: Ruff"
            ],
            "dependsOrder": "parallel",
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            }
        },
        {
            "label": "Security: Vulnerability Scan (Bandit)",
            "detail": "Scan the Backend for security vulnerabilities using Bandit and output the results to a file.",
            "type": "shell",
            "command": "bash",
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/python -m bandit -c bandit.yaml -f json -o ../data/_temp/scans/bandit.json -r ."
            ]
        },
        {
            "label": "Security: Secret Leak Scan (Trufflehog)",
            "detail": "Scans the commit history for any secrets (this can take a while)",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/security/trufflehog_scan.sh",
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Security: Secret Leak Scan (Gitleaks)",
            "detail": "Scans the commit history for any secrets (faster than Trufflehog)",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/security/gitleaks_scan.sh",
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Setup: Install pre-commit hooks",
            "detail": "On opening the folder, installs pre-commit hooks for the project.",
            "type": "shell",
            "command": "bash",
            "args": [
                "-lc",
                "${workspaceFolder}/backend/.venv/bin/pre-commit install"
            ],
            "runOptions": {
                "runOn": "folderOpen"
            },
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Setup: DB + OTEL + Python + Node",
            "detail": "Gives everything we need to be able to begin running the app w/ login.",
            "dependsOn": [
                "Docker: Provide DB",
                "Docker: Provide OTEL LGTM",
                "Docker: Wait for Postgres health",
                "Backend: Install dependencies",
                "Frontend: Install dependencies",
                "DB: Migrate",
                "DB: Seed (.env.local DB)"
            ],
            "dependsOrder": "sequence"
        }
    ]
}